AWSTemplateFormatVersion: '2010-09-09-OC'
Description: default template created for organization with master account 015117255009

Organization:
  MasterAccount:
    Type: OC::ORG::MasterAccount
    Properties:
      AccountName: jompx-management
      AccountId: '015117255009'
      RootEmail: root@jompx.com
      Alias: jompx-management

  OrganizationRoot:
    Type: OC::ORG::OrganizationRoot
    Properties:
      DefaultOrganizationAccessRoleName: OrganizationAccountAccessRole
      ServiceControlPolicies: !Ref RestrictUnusedRegionsSCP

  DeploymentOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Deployment
      Accounts:
        - !Ref CicdTestAccount
        - !Ref CicdProdAccount

  InfrastructureOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Infrastructure
      Accounts:
        - !Ref NetworkAccount
        - !Ref SecurityAccount

  NetworkAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: network
      AccountId: '767397869266'
      RootEmail: network@jompx.com

  SecurityAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: security
      AccountId: '992382594865'
      RootEmail: security@jompx.com

  SuspendedOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Suspended
      Accounts: !Ref OrganizationAccount

  OrganizationAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: organization
      AccountId: '076164328019'
      RootEmail: organization@jompx.com

  CicdTestAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: cicd-test
      AccountId: '863054937555'
      RootEmail: cicd-test@jompx.com

  CicdProdAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: cicd-prod
      AccountId: '896371249616'
      RootEmail: cicd-prod@jompx.com

  WorkloadsOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Workloads
      OrganizationalUnits:
        - !Ref ProdOU
        - !Ref TestOU
        - !Ref DevOU

  ProdOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Prod
      Accounts:
        - !Ref ProdAccount

  ProdAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: prod
      AccountId: '281660020318'
      RootEmail: prod@jompx.com

  DevOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Dev
      Accounts:
        - !Ref SharedServicesDevAccount

  SharedServicesDevAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: shared-services-dev
      AccountId: '058264302432'
      RootEmail: shared-services-dev@jompx.com

  TestOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Test
      Accounts:
        - !Ref TestAccount

  TestAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: test
      AccountId: '706457422044'
      RootEmail: test@jompx.com

  SandboxOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: Sandbox
      Accounts:
        - !Ref Sandbox1Account

  Sandbox1Account:
    Type: OC::ORG::Account
    Properties:
      AccountName: sandbox1
      AccountId: '066209653567'
      RootEmail: sandbox1@jompx.com
      Tags:
        subdomain: sandbox1

  RestrictUnusedRegionsSCP:
    Type: OC::ORG::ServiceControlPolicy
    Properties:
      PolicyName: RestrictUnusedRegions
      Description: Restrict Unused regions
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Sid: DenyUnsupportedRegions
            Effect: Deny
            NotAction:
              - 'cloudfront:*'
              - 'iam:*'
              - 'route53:*'
              - 'support:*'
            Resource: '*'
            Condition:
              StringNotEquals:
                'aws:RequestedRegion':
                  - us-west-2
                  - us-east-1
